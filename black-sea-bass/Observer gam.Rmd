---
title: "CPUE"
author: "Ricky Tabandera"
date: "5/11/2021"
output: html_document
---

```{r cpue-setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(here)
library(mgcv)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cpue-data}
OBSPP<-read.csv(here::here( "OBSPP.csv"))

OBSPEC<-read.csv(here::here( "OBSPEC.csv"))

OB_key<-OBSPEC %>% select(SPECIES_ITIS,NESPP4 )%>% rename("ITISSPP" ="SPECIES_ITIS")

OB_key_join<- dplyr::left_join(OBSPP,OB_key, by= "NESPP4")

SP_group<-read.csv(here::here("species_groupings_V2.csv"))

SP_key<-SP_group  %>% select( COMNAME, SVSPP, ITISSPP, NESPP3, SCINAME) %>% mutate(COMNAME= stringr::str_to_sentence(COMNAME))

OB_sp_join<-dplyr::left_join(OB_key_join,SP_key, by= "ITISSPP")

OB_selected<-OB_sp_join %>% filter(COMNAME == "Black sea bass")



```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}

OB_selected %>% ggplot(aes(x=YEAR,y=HAILWT))+geom_bar(stat="identity")
OB_selected <- DDMMSS_to_DD(OB_selected, "LATHBEG","LONHBEG")


OB_selected %>% dplyr::group_by(YEAR) %>% dplyr::summarise(haul_per_yr=length(unique(LINK3)))%>% ggplot(aes(x=YEAR,y=haul_per_yr))+geom_bar(stat="identity")

library(sf)

OB_selected %>% ggplot(aes(x=LONHBEG))+geom_histogram()

ggplot(data=ecodata::coast)+
  geom_sf()+
  geom_point(aes(x=LON.DD,y=LAT.DD),data=OB_selected)


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
#R package mgcv using the argument ‘select’ equals ‘TRUE
OB_selected <- OB_selected %>% mutate("AREA"=as.factor(AREA), "WGTTYPE"=as.factor(WGTTYPE))

gam_mod <- gam(HAILWT ~ s(YEAR)+s(MONTH)+te(LON.DD,LAT.DD)+WGTTYPE, data = OB_selected, method = "REML", select=TRUE)
coef(gam_mod)
summary(gam_mod)
plot(gam_mod, pages = 2,rug = TRUE)
install.packages("mgcViz")
library(mgcViz)
t1<-mgcViz::getViz(gam_mod)
print(plot(t1), ask = FALSE)

```














