---
title: "BSB Oceanography"
author: "Ricky Tabandera"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
# library("readxl")

```



```{r Excel_cleaning, include=FALSE}

# SHW_SMAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\ShelfWaterVolume_BSB_update.xlsx",sheet =1)
# SHW_NMAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\ShelfWaterVolume_BSB_update.xlsx",sheet =2)
# SHW_MAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\ShelfWaterVolume_BSB_update.xlsx",sheet =3)
# 
# SHW_SMAB %>% write.csv("SHW_SMAB.csv")
# SHW_NMAB %>% write.csv("SHW_NMAB.csv")
# SHW_MAB %>% write.csv("SHW_MAB.csv")
# 
# 
# TSanom_WGOM<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\MAB_GoM_WGB_regAvg_TSanom_BSB.xlsx",sheet = 1)
# TSanom_WGB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\MAB_GoM_WGB_regAvg_TSanom_BSB.xlsx",sheet = 2)
# TSanom_SMAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\MAB_GoM_WGB_regAvg_TSanom_BSB.xlsx",sheet = 3)
# TSanom_NMAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\MAB_GoM_WGB_regAvg_TSanom_BSB.xlsx",sheet = 4)
# TSanom_MAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\MAB_GoM_WGB_regAvg_TSanom_BSB.xlsx",sheet = 5)
# 
# 
# TSanom_WGOM  %>% write.csv("TSanom_WGOM.csv")
# TSanom_WGB  %>% write.csv("TSanom_WGB.csv")
# TSanom_SMAB  %>% write.csv("TSanom_SMAB.csv")
# TSanom_NMAB %>% write.csv("TSanom_NMAB.csv")
# TSanom_MAB %>% write.csv("TSanom_MAB.csv")



SHW_SMAB <- read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\SHW_SMAB.csv")
SHW_NMAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\SHW_NMAB.csv")
SHW_MAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\SHW_MAB.csv")



TSanom_WGOM<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\TSanom_WGOM.csv")
TSanom_WGB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\TSanom_WGB.csv")
TSanom_SMAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\TSanom_SMAB.csv")
TSanom_NMAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\TSanom_NMAB.csv")
TSanom_MAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\TSanom_MAB.csv")




############## mutate data to incude season

#convert decimal year to date
SHW_SMAB$date_ymd<-lubridate::date_decimal(SHW_SMAB$Year, tz = "UTC")
SHW_NMAB$date_ymd<-lubridate::date_decimal(SHW_NMAB$Year, tz = "UTC")
SHW_MAB$date_ymd<-lubridate::date_decimal(SHW_MAB$Year, tz = "UTC")

#extract month


SHW_SMAB$month<-lubridate::month(SHW_SMAB$date_ymd) 
SHW_NMAB$month<-lubridate::month(SHW_NMAB$date_ymd) 
SHW_MAB$month<-lubridate::month(SHW_MAB$date_ymd) 
######## extract year

SHW_SMAB$year<-lubridate::year(SHW_SMAB$date_ymd)
SHW_NMAB$year<-lubridate::year(SHW_NMAB$date_ymd)
SHW_MAB$year<-lubridate::year(SHW_MAB$date_ymd)

# limit to just winter months feb-mar as jan is irregularly avalible 
#very few december measurments
                     
SHW_SMAB<-SHW_SMAB %>%   mutate(season=dplyr::case_when(
  month <= 2 | month < 4 ~ "winter",
  month < 4 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))     

SHW_NMAB<-SHW_NMAB %>%   mutate(season=dplyr::case_when(
  month <= 2 | month < 4 ~ "winter",
  month < 4 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  )) 
SHW_MAB<-SHW_MAB %>%   mutate(season=dplyr::case_when(
  month <= 2 | month < 4 ~ "winter",
  month < 4 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  )) 


#summerize to mean winter for each variable of interest 
SHW_SMAB_winter <-SHW_SMAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom), ShW.T.anom)
                         
SHW_NMAB_winter <-SHW_NMAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))

 SHW_MAB_winter <-SHW_MAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))
 
#Fall 
 
SHW_SMAB_fall <-SHW_SMAB %>% filter(season=="fall") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))
                         
SHW_NMAB_fall <-SHW_NMAB %>% filter(season=="fall") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))

 SHW_MAB_fall <-SHW_MAB %>% filter(season=="fall") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom)) 
 
######### calculate anomoly for bottom T and S
 

TSanom_SMAB<-TSanom_SMAB %>% mutate(T_anom = T -Annual.Avg.T)
TSanom_NMAB<-TSanom_NMAB %>% mutate(T_anom = T -Annual.Avg.T)

 
 
 
#convert decimal year to date
TSanom_WGOM$year_date<-lubridate::date_decimal(TSanom_WGOM$Year, tz = "UTC")
#extract month

TSanom_WGOM$month<-lubridate::month(TSanom_WGOM$year_date) 
TSanom_WGOM$year<-lubridate::year(TSanom_WGOM$year_date)
# limit to just winter months jan-mar
#no december measurments
                     
TSanom_WGOM<-TSanom_WGOM %>%   mutate(season=dplyr::case_when(
  month <= 3 ~ "winter",
  month < 3 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))                    
                         


#################### convert decimal date to month and classify to a season 


#convert decimal year to date
TSanom_WGB$year_date<-lubridate::date_decimal(TSanom_WGB$Year, tz = "UTC")
#extract month

TSanom_WGB$month<-lubridate::month(TSanom_WGB$year_date) 
TSanom_WGB$year<-lubridate::year(TSanom_WGB$year_date)
# limit to just winter months jan-mar
#no december measurments
                     
TSanom_WGB<-TSanom_WGB %>%   mutate(season=dplyr::case_when(
  month <= 3 ~ "winter",
  month < 3 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))                    
                         


#convert decimal year to date
TSanom_SMAB$year_date<-lubridate::date_decimal(TSanom_SMAB$Year, tz = "UTC")
#extract month

TSanom_SMAB$month<-lubridate::month(TSanom_SMAB$year_date) 
TSanom_SMAB$year<-lubridate::year(TSanom_SMAB$year_date)
# limit to just winter months jan-mar
#no december measurments
                     
TSanom_SMAB<-TSanom_SMAB %>%   mutate(season=dplyr::case_when(
  month <= 3 ~ "winter",
  month < 3 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))                    
                         


#convert decimal year to date
TSanom_NMAB$year_date<-lubridate::date_decimal(TSanom_NMAB$Year, tz = "UTC")
#extract month

TSanom_NMAB$month<-lubridate::month(TSanom_NMAB$year_date) 
TSanom_NMAB$year<-lubridate::year(TSanom_NMAB$year_date)
# limit to just winter months jan-mar
#no december measurments
                     
TSanom_NMAB<-TSanom_NMAB %>%   mutate(season=dplyr::case_when(
  month <= 3 ~ "winter",
  month < 3 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))                   
                         



###########################
#convert decimal year to date
TSanom_MAB$year_date<-lubridate::date_decimal(TSanom_MAB$Year, tz = "UTC")
#extract month
TSanom_MAB$month<-lubridate::month(TSanom_MAB$year_date) 
TSanom_MAB$year<-lubridate::year(TSanom_MAB$year_date)
# limit to just winter months jan-mar
#no december measurments
                     
TSanom_MAB<-TSanom_MAB %>%   mutate(season=dplyr::case_when(
  month <= 3 ~ "winter",
  month < 3 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))                    




########################

# calculate winter means and filter to only winter values


WGOM_winter_bot<-TSanom_WGOM %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_bot_T=mean(T,na.rm=T ),mean_bot_S=mean(S,na.rm=T ))

WGB_winter_bot<-TSanom_WGB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_bot_T=mean(T,na.rm=T ),mean_bot_S=mean(S,na.rm=T ))

SMAB_winter_bot<-TSanom_SMAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_bot_T=mean(T,na.rm=T ),mean_bot_S=mean(S,na.rm=T ),mean_bot_T_anom=mean(T_anom,na.rm=T) )

NMAB_winter_bot<-TSanom_NMAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_bot_T=mean(T,na.rm=T ),mean_bot_S=mean(S,na.rm=T ),mean_bot_T_anom=mean(T_anom,na.rm=T))

MAB_winter_bot<-TSanom_MAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_bot_T=mean(T,na.rm=T ),mean_bot_S=mean(S,na.rm=T ))
 







```

## Shelf water volume

Shelf water volume which is a measure of the volume of water bounded inshore of a hydrodynamic feature called the shelf-slope front. In this analysis the shelf water is defined as all water having salinity <34. It is hypothesized that fish are migrating from the self edge and using the shelf slope font as a way-point. The position of this front will vary inter-annually with the higher values indicating the front being pushed further towards the shelf break. As this font moves closer or further from the coast, the available susceptible habitat can expand or contract as black sea bass are known to concentrate slope ward of the front. Miller et al. 2016 Identified a negative impact on catches of both juveniles and adult black sea bass when shelf water volume exceeded 4000 km^3

```{r Shelf water volume, eval=FALSE, warning=FALSE, include=FALSE}
SHW_SMAB_plot<-SHW_SMAB %>% 
  ggplot2::ggplot()+
  geom_line(aes(x=Year, y=ShW.Vol), width = .51, color="black",fill="lightgrey")+
  geom_point(aes(x=Year, y=ShW.Vol))+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(1000,6000, by= 1000))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Mid Atlantic Bight")

SHW_NMAB_plot<-SHW_NMAB %>% 
  ggplot2::ggplot()+
  geom_line(aes(x=Year, y=ShW.Vol), width = .51, color="black",fill="lightgrey")+
  geom_point(aes(x=Year, y=ShW.Vol))+
  ylab(expression(Shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(1000,6000, by= 1000))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Mid Atlantic Bight")

SHW_MAB_plot<-SHW_MAB %>% 
  ggplot2::ggplot()+
  geom_line(aes(x=Year, y=ShW.Vol), width = .51, color="black",fill="lightgrey")+
  geom_point(aes(x=Year, y=ShW.Vol))+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(1000,6000, by= 1000))+
  geom_hline(yintercept=4000, linetype="dashed", color = "red")+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Mid Atlantic Bight")





  
```

```{r SHW_PLOTS, eval=FALSE, include=FALSE}
plot(SHW_SMAB_plot)
plot(SHW_NMAB_plot)
plot(SHW_MAB_plot)
```


```{r SWVanom, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

SHW_SMAB_anom_plot<-SHW_SMAB %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=Year, y=ShW.Vol.anom, fill=ShW.T), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Mid Atlantic Bight")+
  labs(fill="Temperature (C)")
  
SHW_NMAB_anom_plot  <-SHW_NMAB %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=Year, y=ShW.Vol.anom, fill=ShW.T), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Mid Atlantic Bight")+
  labs(fill="Temperature (C)")
  
SHW_MAB_anom_plot  <-SHW_MAB %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=Year, y=ShW.Vol.anom, fill=ShW.T), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Mid Atlantic Bight")+
  labs(fill="Temperature (C)")

plot(SHW_SMAB_anom_plot)
plot(SHW_NMAB_anom_plot)
plot(SHW_MAB_anom_plot)


```


## winter shelf water volume

```{r winter_shelf_water_vol_anom, echo=FALSE, message=FALSE, warning=FALSE}
SHW_SMAB_winter_plot<-SHW_SMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y= mean_SHW , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(0,3000, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Mid Atlantic Bight")+
  labs(fill="Temperature (C)")

SHW_NMAB_winter_plot<-SHW_NMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y= mean_SHW , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(0,3000, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Mid Atlantic Bight")+
  labs(fill="Temperature (C)")

SHW_MAB_winter_plot<-SHW_SMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y= mean_SHW , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(0,3000, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Mid Atlantic Bight")+
  labs(fill="Temperature (C)")

##############


SHW_anom_SMAB_winter_plot<-SHW_SMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Mid Atlantic Bight")+
  labs(fill="Temperature (C)")

SHW_anom_NMAB_winter_plot<-SHW_NMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Mid Atlantic Bight")+
  labs(fill="Temperature (C)")

SHW_anom_MAB_winter_plot<-SHW_SMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Mid Atlantic Bight")+
  labs(fill="Temperature (C)")

plot(SHW_SMAB_winter_plot)
plot(SHW_NMAB_winter_plot)
plot(SHW_MAB_winter_plot)

plot(SHW_anom_SMAB_winter_plot)
plot(SHW_anom_NMAB_winter_plot)
plot(SHW_anom_MAB_winter_plot)

```



```{r fall_shelf_water_vol_anom, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}


SHW_SMAB_fall_plot<-SHW_SMAB_fall %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Fall~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Mid Atlantic Bight")+
  labs(fill="Temperature (C)")


SHW_NMAB_fall_plot<-SHW_NMAB_fall %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Fall~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Mid Atlantic Bight")+
  labs(fill="Temperature (C)")


SHW_MAB_fall_plot<-SHW_MAB_fall %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Fall~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Mid Atlantic Bight")+
  labs(fill="Temperature (C)")

plot(SHW_SMAB_fall_plot)
plot(SHW_NMAB_fall_plot)
plot(SHW_MAB_fall_plot)


```


## Regional in-situ winter bottom temperature and salinity with anomaly

All available CTD data within 10m of the bottom between the northern and southern MAB region and as a whole. Regional time series were computed as follows: area-weighted regional mean values were computed for each survey in the OCDBS and a reference annual cycle was removed (fit to observations from 1981-2010) to get seasonal anomalies. 

note: winter coverage is very sparse due to the winter ECOMON surveys ending. A better approach may to be to use a two month span at the end of winter where coverage is better i.e. FEB-MAR rather than a whole winter. 


```{r regional_t_s_plots, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

# TSanom_WGOM_T_plot<-TSanom_WGOM %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Western Gulf of Maine")
# 
# 
# 
# TSanom_WGOM_S_plot<-TSanom_WGOM %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Western Gulf of Maine")
# 
# #####################
# 
# TSanom_WGB_T_plot<-TSanom_WGB %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Western Georges Bank")
# 
# 
# 
# TSanom_WGB_S_plot<-TSanom_WGB %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Western Georges Bank")
# 
# 
# 
# #################
# TSanom_SMAB_T_plot<-TSanom_SMAB %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Southern Mid Atlantic Bight")
# 
# 
# 
# TSanom_SMAB_S_plot<-TSanom_SMAB %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Southern Mid Atlantic Bight")
# 
# #######  
# 
# TSanom_NMAB_T_plot<-TSanom_NMAB %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Northern Mid Atlantic Bight")
# 
# 
# 
# TSanom_NMAB_S_plot<-TSanom_NMAB %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Northern Mid Atlantic Bight")
#   
# #############
# 
# 
# TSanom_MAB_T_plot<-TSanom_MAB %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("All Mid Atlantic Bight")
# 
# 
# 
# TSanom_MAB_S_plot<-TSanom_MAB %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("All Mid Atlantic Bight")
#   
# plot(TSanom_WGOM_T_plot)
# plot(TSanom_WGOM_S_plot)
# 
# plot(TSanom_WGB_T_plot)
# plot(TSanom_WGB_S_plot)
# 
# 
# plot(TSanom_SMAB_T_plot)
# plot(TSanom_SMAB_S_plot)
# 
# plot(TSanom_NMAB_T_plot)
# plot(TSanom_NMAB_S_plot)
# 
# plot(TSanom_MAB_T_plot)
# plot(TSanom_MAB_S_plot)

```

```{r regional_t_s_anom_plots, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

# TSanom_WGOM_Tanom_plot<-TSanom_WGOM %>% 
#   ggplot(aes(x=Year,y= (`T`-Annual.Avg.T) ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Western Gulf of Maine")
# 
# 
# 
# TSanom_WGOM_S_plot<-TSanom_WGOM %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Western Gulf of Maine")
# 
# #####################
# 
# TSanom_WGB_T_plot<-TSanom_WGB %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Western Georges Bank")
# 
# 
# 
# TSanom_WGB_S_plot<-TSanom_WGB %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Western Georges Bank")
# 
# 
# 
# #################
# TSanom_SMAB_T_plot<-TSanom_SMAB %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Southern Mid Atlantic Bight")
# 
# 
# 
# TSanom_SMAB_S_plot<-TSanom_SMAB %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Southern Mid Atlantic Bight")
# 
# #######  
# 
# TSanom_NMAB_T_plot<-TSanom_NMAB %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Northern Mid Atlantic Bight")
# 
# 
# 
# TSanom_NMAB_S_plot<-TSanom_NMAB %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("Northern Mid Atlantic Bight")
#   
# #############
# 
# 
# TSanom_MAB_T_plot<-TSanom_MAB %>% 
#   ggplot(aes(x=Year,y= `T` ))+
#   geom_point(color="red")+
#   geom_line()+
#   ylab("Mean temperature(C)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("All Mid Atlantic Bight")
# 
# 
# 
# TSanom_MAB_S_plot<-TSanom_MAB %>% 
#   ggplot(aes(x=Year,y=as.numeric( `S` )))+
#   geom_point(color="blue")+
#   geom_line()+
#   ylab("Mean salinity (PSU)")+
#     theme(axis.text.x = element_text(angle = 90),
#         panel.border= element_blank(),
#         panel.background= element_rect(fill = "white"))+
#    scale_x_continuous(breaks = seq(1977,2021, by= 1))+
#   ggtitle("All Mid Atlantic Bight")
#   
# plot(TSanom_WGOM_T_plot) 
# plot(TSanom_WGOM_S_plot)
# 
# plot(TSanom_WGB_T_plot)
# plot(TSanom_WGB_S_plot)
# 
# 
# plot(TSanom_SMAB_T_plot)
# plot(TSanom_SMAB_S_plot)
# 
# plot(TSanom_NMAB_T_plot)
# plot(TSanom_NMAB_S_plot)
# 
# plot(TSanom_MAB_T_plot)
# plot(TSanom_MAB_S_plot)

```


```{r winter_bottom_temp_and_salinity, echo=FALSE, message=FALSE, warning=FALSE}


WGOM_winter_bot_plot<-WGOM_winter_bot %>%
  ggplot(aes(x=year,y=mean_bot_T))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean winter bottom temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Western Gulf Of Maine")

###############

WGB_winter_bot_plot<-WGB_winter_bot %>%
  ggplot(aes(x=year,y=mean_bot_T))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean winter bottom temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Western Georges bank")


####################



SMAB_winter_bot_plot<-SMAB_winter_bot %>%
  ggplot(aes(x=year,y=mean_bot_T))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean winter bottom temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Southern Mid Atlantic Bight")

##################################



NMAB_winter_bot_plot<-NMAB_winter_bot %>%
  ggplot(aes(x=year,y=mean_bot_T))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean winter bottom temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Northern Mid Atlantic Bight")

##############

MAB_winter_bot_plot<-MAB_winter_bot %>%
  ggplot(aes(x=year,y=mean_bot_T))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("All Mid Atlantic Bight")


#########################


plot(WGOM_winter_bot_plot)
plot(WGB_winter_bot_plot)
plot(SMAB_winter_bot_plot)
plot(NMAB_winter_bot_plot)
plot(MAB_winter_bot_plot)


```


## Gulf Stream Index
The GSI is calculated based on the method presented by Pérez-Hernández and Joyce (2014). This gulf stream index is a position anomaly meaning the larger the value of the index the further north the northern wall of the Gulf Stream is for that year.


```{r Gulf_stream_index, echo=FALSE}
GSI<-ecodata::gsi

GSI %>%
  dplyr::mutate(Year = floor(Time)) %>%
  dplyr::group_by(Year) %>%
  dplyr::summarise(Value = mean(Value)) %>%
  dplyr::mutate(hline = mean(Value)) %>%
  ggplot(aes(x=Year, y=Value))+
  ggplot2::geom_line() +
  ggplot2::geom_point() +
  ggplot2::ylab("Gulf Stream position anomaly") +
  ggplot2::xlab(element_blank())+
  ggplot2::ggtitle("Gulf Stream Index") +
  ggplot2::scale_x_continuous(expand = c(0.01, 0.01),breaks = seq(1950,2021, by= 5))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))
 


GSI_annual<-GSI %>%
  dplyr::mutate(Year = floor(Time)) %>%
  dplyr::group_by(Year) %>%
  dplyr::summarise(Value = mean(Value)) %>%
  dplyr::mutate(hline = mean(Value))


```


```{r export_data, include=FALSE}

# write.csv(SHW_SMAB_winter, file="SHW_SMAB_winter.csv")
# write.csv(SHW_SMAB_winter, file="SHW_NMAB_winter.csv")
# write.csv(SHW_SMAB_winter, file="SHW_MAB_winter.csv")
# 
# 
# write.csv(NMAB_winter_bot, file="SMAB_winter_bot.csv")
# write.csv(NMAB_winter_bot, file="NMAB_winter_bot.csv")
# write.csv(NMAB_winter_bot, file="MAB_winter_bot.csv")
# 
# write.csv(GSI_annual, file = "GSI_annual.csv")


```



## Cross correlation testing

Explorations into the association between bottom conditions and Black sea bass recruitment deviations. recruitment deviations from the 2021 operational assessment. This model output lacks 2020 data and thus 2019 is the terminal year. Bottom conditions are also limited to this time span. Temperature anomaly are used to avoid seasonal and annual patterns. The association is likely to occur with a time lag as current conditions would likely manifest in following years. Horizontal line indicates significant cross correlation   



```{r cor_testing, message=FALSE, warning=FALSE, include=FALSE}
# install.packages("astsa")
# install.packages("TSstudio")
# install.packages("timetk")
# install.packages("forecast")



# read in recruitment deveations from the 2021 opperational assesment. This model output lacks 2020 data and thus 2019 is the terminal year



South_rec_dev<-read.csv("~//EDAB//esp_data_aggregation//black-sea-bass//South_rec_dev.csv")
North_rec_dev<-read.csv("~//EDAB//esp_data_aggregation//black-sea-bass//North_rec_dev.csv")


South_rec_dev$recruit_dev_Ln<-exp(South_rec_dev$log_recruit_devs)
South_rec_dev$recruit_dev_log10<-(10^(South_rec_dev$log_recruit_devs))

#limit bottom mesurments to align with the years with recruitment deveations
# 1989-2019
SMAB_winter_bot_89<-SMAB_winter_bot %>% filter(year %in% (1989:2019))
NMAB_winter_bot_89<-NMAB_winter_bot %>% filter(year %in% (1989:2019))



S_rec_temp<-dplyr::full_join (South_rec_dev,SMAB_winter_bot_89, by="year")
N_rec_temp<-dplyr::full_join (North_rec_dev,NMAB_winter_bot_89, by="year")




# 
# south_join<-dplyr::full_join(South_rec_dev,SMAB_winter_bot_89, by="year")
# 
# south_ts<-ts(data = south_join[, c("log_recruit_devs", "mean_bot_T_anom")], # selecting 2 variables
#    start = c(1989, 01), # start date
#    end = c(2019, 12), # end date 
#    frequency = 1)
# 
# south_rec_ts<-ts(data = south_join[, c("log_recruit_devs")], # selecting 2 variables
#    start = c(1989), # start date
#    end = c(2019), # end date 
#    frequency = 1)
# 
# south_T_anom_ts<-ts(data = south_join[, c("mean_bot_T_anom")], # selecting 2 variables
#    start = c(1989), # start date
#    end = c(2019), # end date 
#    frequency = 1)



# south_join<-south_join %>% mutate(T_lag1=lag(mean_bot_T_anom,order_by = year), T_lag2=lag(T_lag1,order_by = year),T_lag3=lag(T_lag2,order_by = year),T_lag4=lag(T_lag3,order_by = year))
# 
# 
# 
# south_join %>% ggplot(aes(x=log_recruit_devs, y=T_lag1))+geom_point()+geom_smooth()

#use recrutment deviations for simple correlations 




# z scale both vars
#remove lines from plots


```


### southern MAB ccf 
Peak correlation occurs at a lag of 2 years. This could be and artifact due to how calendar year is in winter conditions   

```{r southern_mab_ccf, echo=FALSE, message=FALSE, warning=FALSE}

#ccf(South_rec_dev$log_recruit_devs,SMAB_winter_bot_89$mean_bot_T_anom)

s_ccf_log<-ccf(South_rec_dev$log_recruit_devs,SMAB_winter_bot_89$mean_bot_T_anom, plot = F)
s_x<-c(-11:11)
s_y<-c(s_ccf_log$acf)


s_ccf_log_tidy<-as.data.frame(cbind(s_x,s_y))

s_ccf_plot<-s_ccf_log_tidy %>% 
  ggplot(aes(x=s_x,y=s_y))+
  geom_col(width = .1)+
  geom_hline(yintercept = c(.35))+
  xlab("Lag")+
  ylab("ACF")+
  ggtitle("Log recruitment deviations & winter bottom temperature anomaly", subtitle = "Southern MAB")+
  theme_minimal()


plot(s_ccf_plot)

```

### Northern MAB CCF
 
 Peak correlation occurs with a 1 year lag.
 
```{r Northern_mab_ccf, echo=FALSE, message=FALSE, warning=FALSE}

# ccf(North_rec_dev$log_recruit_devs,NMAB_winter_bot_89$mean_bot_T_anom)

N_ccf_log<-ccf(North_rec_dev$log_recruit_devs,NMAB_winter_bot_89$mean_bot_T_anom, plot = F)
N_x<-c(-11:11)
N_y<-c(N_ccf_log$acf)


N_ccf_log_tidy<-as.data.frame(cbind(N_x,N_y))

N_ccf_plot<-N_ccf_log_tidy %>% 
  ggplot(aes(x=N_x,y=N_y))+
  geom_col(width = .1)+
  geom_hline(yintercept = c(.35))+
  xlab("Lag")+
  ylab("ACF")+
  ggtitle("Log recruitment deviations & winter bottom temperature anomaly", subtitle = "Northern MAB")+
  theme_minimal()


plot(N_ccf_plot)

```

### Gulf stream wall index CCF

Differing patterns in association is observed across the north vs south. Northern MAB has -3 and -7 lags, while Southern MAB has no significant time lags that correlate with recruitment deviations.  


```{r GSI_CCF, echo=FALSE, message=FALSE, warning=FALSE}

GSI_89<-GSI_annual %>% filter(Year %in% c(1989:2019))
#north

# ccf(North_rec_dev$log_recruit_devs,GSI_89$Value)
# 
# ccf(South_rec_dev$log_recruit_devs,GSI_89$Value)


N_GSI_ccf_log<-ccf(North_rec_dev$log_recruit_devs,GSI_89$Value, plot = F)
S_GSI_ccf_log<-ccf(South_rec_dev$log_recruit_devs,GSI_89$Value, plot = F)

N_GSI_x<-c(-11:11)
S_GSI_x<-c(-11:11)

N_GSI_y<-c(N_GSI_ccf_log$acf)
S_GSI_y<-c(S_GSI_ccf_log$acf)

N_GSI_ccf_log_tidy<-as.data.frame(cbind(N_GSI_x,N_GSI_y))
S_GSI_ccf_log_tidy<-as.data.frame(cbind(S_GSI_x,S_GSI_y))




N_GSI_ccf_plot<-N_GSI_ccf_log_tidy %>% 
  ggplot(aes(x=N_GSI_x,y=N_GSI_y))+
  geom_col(width = .1)+
  geom_hline(yintercept = c(.35))+
  xlab("Lag")+
  ylab("ACF")+
  ggtitle("Log recruitment deviations & Gulf stream wall index", subtitle = "Northern MAB")+
  theme_minimal()


S_GSI_ccf_plot<-S_GSI_ccf_log_tidy %>% 
  ggplot(aes(x=S_GSI_x,y=S_GSI_y))+
  geom_col(width = .1)+
  geom_hline(yintercept = c(.35))+
  xlab("Lag")+
  ylab("ACF")+
  ggtitle("Log recruitment deviations & Gulf stream wall index", subtitle = "Southern MAB")+
  theme_minimal()

plot(N_GSI_ccf_plot)
plot(S_GSI_ccf_plot)




```



