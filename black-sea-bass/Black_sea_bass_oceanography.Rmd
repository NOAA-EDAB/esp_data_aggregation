---
title: "BSB Oceanography"
author: "Ricky Tabandera"
date: "6/8/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
# library("readxl")

```



```{r Excel cleaning, include=FALSE}

# SHW_SMAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\ShelfWaterVolume_BSB_update.xlsx",sheet =1)
# SHW_NMAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\ShelfWaterVolume_BSB_update.xlsx",sheet =2)
# SHW_MAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\ShelfWaterVolume_BSB_update.xlsx",sheet =3)
# 
# SHW_SMAB %>% write.csv("SHW_SMAB.csv")
# SHW_NMAB %>% write.csv("SHW_NMAB.csv")
# SHW_MAB %>% write.csv("SHW_MAB.csv")
# 
# 
# 
# TSanom_SMAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\MAB_regAvg_TSanom_BSB.xlsx",sheet = 1) 
# TSanom_NMAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\MAB_regAvg_TSanom_BSB.xlsx",sheet = 2) 
# TSanom_MAB<-readxl::read_xlsx("~\\EDAB\\esp_data_aggregation\\black-sea-bass\\MAB_regAvg_TSanom_BSB.xlsx",sheet = 3) 
# 
# TSanom_SMAB  %>% write.csv("TSanom_SMAB.csv")
# TSanom_NMAB %>% write.csv("TSanom_NMAB.csv")
# TSanom_MAB %>% write.csv("TSanom_MAB.csv")



SHW_SMAB <- read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\SHW_SMAB.csv")
SHW_NMAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\SHW_NMAB.csv")
SHW_MAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\SHW_MAB.csv")





TSanom_SMAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\TSanom_SMAB.csv")
TSanom_NMAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\TSanom_NMAB.csv")
TSanom_MAB<-read.csv("~\\EDAB\\esp_data_aggregation\\data\\Oceanography\\TSanom_MAB.csv")




############## mutate data to incude season

#convert decimal year to date
SHW_SMAB$date_ymd<-lubridate::date_decimal(SHW_SMAB$Year, tz = "UTC")
SHW_NMAB$date_ymd<-lubridate::date_decimal(SHW_NMAB$Year, tz = "UTC")
SHW_MAB$date_ymd<-lubridate::date_decimal(SHW_MAB$Year, tz = "UTC")
#extract month


SHW_SMAB$month<-lubridate::month(SHW_SMAB$date_ymd) 
SHW_NMAB$month<-lubridate::month(SHW_NMAB$date_ymd) 
SHW_MAB$month<-lubridate::month(SHW_MAB$date_ymd) 
######## extract year

SHW_SMAB$year<-lubridate::year(SHW_SMAB$date_ymd)
SHW_NMAB$year<-lubridate::year(SHW_NMAB$date_ymd)
SHW_MAB$year<-lubridate::year(SHW_MAB$date_ymd)

# limit to just winter months feb-mar as jan is irregularly avalible 
#no december measurments
                     
SHW_SMAB<-SHW_SMAB %>%   mutate(season=dplyr::case_when(
  month <= 2 | month < 4 ~ "winter",
  month < 4 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))     

SHW_NMAB<-SHW_NMAB %>%   mutate(season=dplyr::case_when(
  month <= 2 | month < 4 ~ "winter",
  month < 4 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  )) 
SHW_MAB<-SHW_MAB %>%   mutate(season=dplyr::case_when(
  month <= 2 | month < 4 ~ "winter",
  month < 4 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  )) 


#summerize to mean winter for each variable of interest 
SHW_SMAB_winter <-SHW_SMAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))
                         
SHW_NMAB_winter <-SHW_NMAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))

 SHW_MAB_winter <-SHW_MAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))
 
#Fall 
 
SHW_SMAB_fall <-SHW_SMAB %>% filter(season=="fall") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))
                         
SHW_NMAB_fall <-SHW_NMAB %>% filter(season=="fall") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom))

 SHW_MAB_fall <-SHW_MAB %>% filter(season=="fall") %>% group_by(year) %>% summarise(mean_SHW=mean(ShW.Vol,na.rm=T ),mean_SHW_anom=mean(ShW.Vol.anom,na.rm=T ), mean_SHW_T=mean(ShW.T,na.rm=T),mean_SHW_T_anom=mean( ShW.T.anom)) 
 








```

## Shelf water volume

Shelf water volume which is a measure of the volume of water bounded inshore of a hydrodynamic feature called the shelf-slope front. In this analysis the shelf water is defined as all water having salinity <34. It is hypothesized that fish are migrating from the self edge and using the shelf slope font as a way-point. The position of this front will vary inter-annually with the higher values indicating the front being pushed further towards the shelf break. As this font moves closer or further from the coast, the available susceptible habitat can expand or contract as black sea bass are known to concentrate slope ward of the front. Miller et al. 2016 Identified a negative impact on catches of both juveniles and adult black sea bass when shelf water volume exceeded 4000 km^3

```{r Shelf water volume, echo=FALSE, warning=FALSE}
SHW_SMAB_plot<-SHW_SMAB %>% 
  ggplot2::ggplot()+
  geom_line(aes(x=Year, y=ShW.Vol), width = .51, color="black",fill="lightgrey")+
  geom_point(aes(x=Year, y=ShW.Vol))+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(1000,6000, by= 1000))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Middle Atlantic Bight")

SHW_NMAB_plot<-SHW_NMAB %>% 
  ggplot2::ggplot()+
  geom_line(aes(x=Year, y=ShW.Vol), width = .51, color="black",fill="lightgrey")+
  geom_point(aes(x=Year, y=ShW.Vol))+
  ylab(expression(Shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(1000,6000, by= 1000))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Middle Atlantic Bight")

SHW_MAB_plot<-SHW_MAB %>% 
  ggplot2::ggplot()+
  geom_line(aes(x=Year, y=ShW.Vol), width = .51, color="black",fill="lightgrey")+
  geom_point(aes(x=Year, y=ShW.Vol))+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(1000,6000, by= 1000))+
  geom_hline(yintercept=4000, linetype="dashed", color = "red")+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Middle Atlantic Bight")





  
```

```{r, echo=FALSE}
plot(SHW_SMAB_plot)
plot(SHW_NMAB_plot)
plot(SHW_MAB_plot)
```

### Shelf water volume anomaly
The anomaly is the excess volume above the seasonal and regional mean for each period. 


```{r SWVanom, echo=FALSE, message=FALSE, warning=FALSE}




SHW_SMAB_anom_plot<-SHW_SMAB %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=Year, y=ShW.Vol.anom, fill=ShW.T), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Middle Atlantic Bight")
  
SHW_NMAB_anom_plot  <-SHW_NMAB %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=Year, y=ShW.Vol.anom, fill=ShW.T), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Middle Atlantic Bight")
  
SHW_MAB_anom_plot  <-SHW_MAB %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=Year, y=ShW.Vol.anom, fill=ShW.T), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Middle Atlantic Bight")

plot(SHW_SMAB_anom_plot)
plot(SHW_NMAB_anom_plot)
plot(SHW_MAB_anom_plot)


```


## winter shelf water volume and anomaly

```{r winter_shelf_water_vol_anom, echo=FALSE, message=FALSE, warning=FALSE}
SHW_SMAB_winter_plot<-SHW_SMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Middle Atlantic Bight")

SHW_NMAB_winter_plot<-SHW_SMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Middle Atlantic Bight")

SHW_MAB_winter_plot<-SHW_SMAB_winter %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Winter~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Middle Atlantic Bight")

plot(SHW_SMAB_winter_plot)
plot(SHW_NMAB_winter_plot)
plot(SHW_MAB_winter_plot)

```
 



## Shelf water volume fall

To replicate Millter et al. 2016 methods the previous fall shelf water volume was used in the GAM. 

```{r fall_shelf_water_vol_anom, echo=FALSE, message=FALSE, warning=FALSE}


SHW_SMAB_fall_plot<-SHW_SMAB_fall %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Fall~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Southern Middle Atlantic Bight")


SHW_NMAB_fall_plot<-SHW_SMAB_fall %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Fall~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("Northern Middle Atlantic Bight")


SHW_MAB_fall_plot<-SHW_SMAB_fall %>% 
  ggplot2::ggplot()+
  geom_col(aes(x=year, y=mean_SHW_anom , fill=mean_SHW_T ), width = .51, )+
  geom_hline(yintercept = 0)+
  ylab(expression(Fall~shelf~water~volume~anomoly~km^{"3"}))+
  scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  scale_y_continuous(breaks = seq(-1500,1500, by= 500))+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
  ggtitle("All Middle Atlantic Bight")

plot(SHW_SMAB_fall_plot)
plot(SHW_NMAB_fall_plot)
plot(SHW_MAB_fall_plot)


```







## Regional in-situ bottom temperature and salinity with anomaly

All available CTD data within 10m of the bottom between the northern and southern MAB region and as a whole. Regional time series were computed as follows: area-weighted regional mean values were computed for each survey in the OCDBS and a reference annual cycle was removed (fit to observations from 1981-2010) to get seasonal anomalies. 

note: winter coverage is very sparse due to the winter ECOMON surveys ending. A better approach may to be to use a two month span at the end of winter where coverage is better i.e. FEB-MAR rather than a whole winter. 


```{r regional_t_s_plots, echo=FALSE, message=FALSE, warning=FALSE}

TSanom_SMAB_T_plot<-TSanom_SMAB %>% 
  ggplot(aes(x=Year,y= `T` ))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Southern Middle Atlantic Bight")



TSanom_SMAB_S_plot<-TSanom_SMAB %>% 
  ggplot(aes(x=Year,y=as.numeric( `S` )))+
  geom_point(color="blue")+
  geom_line()+
  ylab("Mean salinity (PSU)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Southern Middle Atlantic Bight")

#######  

TSanom_NMAB_T_plot<-TSanom_NMAB %>% 
  ggplot(aes(x=Year,y= `T` ))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Northern Middle Atlantic Bight")



TSanom_NMAB_S_plot<-TSanom_NMAB %>% 
  ggplot(aes(x=Year,y=as.numeric( `S` )))+
  geom_point(color="blue")+
  geom_line()+
  ylab("Mean salinity (PSU)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Northern Middle Atlantic Bight")
  
#############


TSanom_MAB_T_plot<-TSanom_MAB %>% 
  ggplot(aes(x=Year,y= `T` ))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("All Middle Atlantic Bight")



TSanom_MAB_S_plot<-TSanom_MAB %>% 
  ggplot(aes(x=Year,y=as.numeric( `S` )))+
  geom_point(color="blue")+
  geom_line()+
  ylab("Mean salinity (PSU)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("All Middle Atlantic Bight")
  

plot(TSanom_SMAB_T_plot)
plot(TSanom_SMAB_S_plot)

plot(TSanom_NMAB_T_plot)
plot(TSanom_NMAB_S_plot)

plot(TSanom_MAB_T_plot)
plot(TSanom_MAB_S_plot)

```


```{r winter_bottom_temp_and_salinity, echo=FALSE, message=FALSE, warning=FALSE}


#convert decimal year to date
TSanom_SMAB$year_date<-lubridate::date_decimal(TSanom_SMAB$Year, tz = "UTC")
#extract month

TSanom_SMAB$month<-lubridate::month(TSanom_SMAB$year_date) 
TSanom_SMAB$year<-lubridate::year(TSanom_SMAB$year_date)
# limit to just winter months jan-mar
#no december measurments
                     
TSanom_SMAB<-TSanom_SMAB %>%   mutate(season=dplyr::case_when(
  month <= 3 ~ "winter",
  month < 3 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))                    
                         
SMAB_winter_bot<-TSanom_SMAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_bot_T=mean(T,na.rm=T ),mean_bot_S=mean(S,na.rm=T ))

SMAB_winter_bot_plot<-SMAB_winter_bot %>%
  ggplot(aes(x=year,y=mean_bot_T))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean winter bottom temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Southern Middle Atlantic Bight")

##################################

#convert decimal year to date
TSanom_NMAB$year_date<-lubridate::date_decimal(TSanom_NMAB$Year, tz = "UTC")
#extract month

TSanom_NMAB$month<-lubridate::month(TSanom_NMAB$year_date) 
TSanom_NMAB$year<-lubridate::year(TSanom_NMAB$year_date)
# limit to just winter months jan-mar
#no december measurments
                     
TSanom_NMAB<-TSanom_NMAB %>%   mutate(season=dplyr::case_when(
  month <= 3 ~ "winter",
  month < 3 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))                   
                         
NMAB_winter_bot<-TSanom_NMAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_bot_T=mean(T,na.rm=T ),mean_bot_S=mean(S,na.rm=T ))

NMAB_winter_bot_plot<-NMAB_winter_bot %>%
  ggplot(aes(x=year,y=mean_bot_T))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean winter bottom temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("Northern Middle Atlantic Bight")


###########################
#convert decimal year to date
TSanom_MAB$year_date<-lubridate::date_decimal(TSanom_MAB$Year, tz = "UTC")
#extract month
TSanom_MAB$month<-lubridate::month(TSanom_MAB$year_date) 
TSanom_MAB$year<-lubridate::year(TSanom_MAB$year_date)
# limit to just winter months jan-mar
#no december measurments
                     
TSanom_MAB<-TSanom_MAB %>%   mutate(season=dplyr::case_when(
  month <= 3 ~ "winter",
  month < 3 | month < 6 ~ "spring",
  month < 6 | month <= 8 ~ "summer",
  month <= 9 | month < 12 ~ "fall"
  ))                    
                         
MAB_winter_bot<-TSanom_MAB %>% filter(season=="winter") %>% group_by(year) %>% summarise(mean_bot_T=mean(T,na.rm=T ),mean_bot_S=mean(S,na.rm=T ))

MAB_winter_bot_plot<-MAB_winter_bot %>%
  ggplot(aes(x=year,y=mean_bot_T))+
  geom_point(color="red")+
  geom_line()+
  ylab("Mean temperature(C)")+
    theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))+
  ggtitle("All Middle Atlantic Bight")


#########################

#fall 


##################
plot(SMAB_winter_bot_plot)
plot(NMAB_winter_bot_plot)
plot(MAB_winter_bot_plot)


```






## Gulf of Maine and Georges bank bottom temperature

Placeholder with SOE information extracted from ecodata. Data occurs at annual time scale and is across the whole EPU.

```{r GB_GOM_SOE_bottom_T, echo=FALSE, message=FALSE, warning=FALSE}

#remotes::install_github("https://github.com/NOAA-EDAB/ecodata")

eco_bottom_temp<-ecodata::bottom_temp



bottom_t_anom_GOM_plot<-eco_bottom_temp %>%
  filter(EPU=="GOM" & Var=="bottom temp anomaly in situ") %>%
  ggplot(aes(x=Time, y=Value))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Bottom temperature anomoly (C)")+
  ggtitle("Gulf of Maine in situ")+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))

bottom_t_anom_GB_plot<-eco_bottom_temp %>%
  filter(EPU=="GB" & Var=="bottom temp anomaly in situ") %>%
  ggplot(aes(x=Time, y=Value))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Bottom temperature anomoly (C)")+
  ggtitle("Georges bank in situ")+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))
#get real bottom temp by combining anomoly and the long term mean
eco_bottom_temp_bt<-eco_bottom_temp %>%tidyr::spread(Var,Value)
colnames(eco_bottom_temp_bt)<-c("Time","EPU","Units", "BT_amom","BT_ref","SST_ref", "SST_amom" )
eco_bottom_temp_real<-eco_bottom_temp_bt %>% group_by(Time, EPU) %>% mutate(bottom_T=(BT_amom+BT_ref))


bottom_t_real_GB_plot<-eco_bottom_temp_real %>%
  filter(EPU=="GB") %>%
  ggplot(aes(x=Time, y=bottom_T))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Bottom temperature (C)")+
  ggtitle("Georges bank in situ")+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))

bottom_t_real_GOM_plot<-eco_bottom_temp_real %>%
  filter(EPU=="GOM") %>%
  ggplot(aes(x=Time, y=bottom_T))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Bottom temperature (C)")+
  ggtitle("Gulf of Maine in situ")+
  theme(axis.text.x = element_text(angle = 90),
        panel.border= element_blank(),
        panel.background= element_rect(fill = "white"))+
   scale_x_continuous(breaks = seq(1977,2021, by= 1))




plot(bottom_t_anom_GOM_plot)
plot(bottom_t_anom_GB_plot)
plot(bottom_t_real_GB_plot)
plot(bottom_t_real_GOM_plot)
```





## Winter available habitat 

Using a reanalysis product to get estimated available habitat during the winter months. These reanalysis products will use all insitu data and use physics to predict and interpolate over missing cells. With this tool we can expand the temporal scale of our bottom temperature and salinity questions. The main indicator of question relate to the amount of available habitat in winter. Proposed parameters for suitable habitat is >33 PSU and 8Â°C in FEB-MAR. The hypothesis is years with more available habitat will require shorter migration distances and result in lower 
