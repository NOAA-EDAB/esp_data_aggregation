---
title: "Commercial landings"
author: "Ricky Tabandera"
date: "5/3/2021"
output: html_document
prarams:
  species: "Black sea bass"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(comlandr)
library(dbutils)
library(remotes)
library(tidyverse)


```

### Commercial fishing gear 
Fishing gear can range widely in their catchability, selectivity, and effective areas of opperations. Using `comlandr` to extract reported gear used in the many commercial fisheries in the north east and any trends and/or shifts that may have occured as one potentual explanitory factor on changes in fisheries landings/revenue.  

```{r gear-wrangling}
load(file="com_landings_test.rdata")
com_gear<-`50B45718`
com_key<-unique(com_gear$NESPP3)
#unsure if NESPP3 and SVSPP are the same, going to asume so and correct later if not 
sp_key<-NEesp::species_key
sp_key<- sp_key %>% dplyr::rename("NESPP3"="SVSPP")
key_join<-dplyr::left_join(com_gear,sp_key,by="NESPP3" )

```

## Including Plots

You can also embed plots, for example:

```{r gear, echo=FALSE}

key_join <-key_join %>% drop_na()
key_join %>% 
  group_by(YEAR, GEAR) %>%
  dplyr::summarise(gear.count=length(GEAR))%>%
  ggplot2::ggplot(aes(x= YEAR,y= gear.count,color=GEAR))+
  ggplot2::geom_point()+
  geom_line()+
  nmfspalette::scale_fill_nmfs(palette = "regional web")+
  theme(axis.text.x = element_text(angle = 90))+
  xlab("Year")+
  ylab("# gear type records")


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r, gear-diversity}

gear.diversity<-key_join %>% group_by(YEAR, EPU, GEAR) %>% summarise(gear.count=(length(GEAR))) 

gear.diversity<-gear.diversity %>%
  group_by(YEAR, GEAR) %>%
  mutate( gear.prop= (gear.count/sum(gear.count)))


gear.H<-gear.diversity %>% group_by(YEAR, EPU) %>% dplyr::summarise(shannon= -sum(gear.prop*log(gear.prop))) 

gear.H %>% ggplot(aes(x=YEAR, y= shannon, color=EPU))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("gear diversity index (H')")




```

```{r}

key_join %>%
  ggplot2::ggplot(aes(x=GEAR,fill=GEAR))+
  ggplot2::geom_point()+
  nmfspalette::scale_fill_nmfs(palette = "regional web")+
  theme(axis.text.x = element_text(angle = 90))

```


```{r, gear-by-species}
gear.spp<-key_join%>% filter(Species=="Black sea bass")
  
gear.spp %>% 
  group_by(YEAR, EPU) %>% 
  mutate(gear.count=length(GEAR)) %>%  
  ggplot2::ggplot(aes(x=YEAR, y=gear.count, fill=GEAR))+
  ggplot2::geom_bar(stat="identity")+
  theme(axis.text.x = element_text(angle = 90))

```

