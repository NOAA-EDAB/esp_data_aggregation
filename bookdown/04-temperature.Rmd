## Temperature

```{r, temp_functions, cache = params$cache}
source(here::here("R/full_report_functions", "get_survdat_info.R"))
```

```{r, tempe_data_species}
survey_data <- params$survey_data[params$survey_data$Species == species, ]
```

Surface and bottom temperature data were pulled from ``r params$survey_source``. 

### Figures

Separate geom_gls() functions were fit for fall and spring measurements; trend lines are only shown when the trend was statistically significant, so some plots may have fewer than two trend lines. Fall has solid trend lines, and spring has dashed trend lines. Please note, sometimes the survey observed a small number of fish outside of the defined stock area.

```{r, stemp, fig.cap = paste(species, "surface temperature")}
generate_plot(survey_data,
  variable = "SURFTEMP",
  ytitle = "Surface temperature"
)
```

```{r, btemp, fig.cap = paste(species, "bottom temperature")}
generate_plot(survey_data,
  variable = "BOTTEMP",
  ytitle = "Bottom temperature"
)
```

### Summary
```{r, temp_summary}
generate_table(survey_data,
  variable = "SURFTEMP",
  cap = "Surface temperature"
)

generate_table(survey_data,
  variable = "BOTTEMP",
  cap = "Bottom temperature"
)
```

### Data
```{r, temp_data}
data <- survey_data %>%
  dplyr::select(
    YEAR, SEASON, Region, date,
    fish_id, SURFTEMP, BOTTEMP
  ) %>%
  dplyr::filter(SURFTEMP > 0 | BOTTEMP > 0) %>%
  dplyr::group_by(YEAR, SEASON, Region, date, fish_id) %>%
  dplyr::distinct() %>% # remove repeated row info
  dplyr::summarise(
    day_mean_surf = mean(SURFTEMP),
    day_mean_bot = mean(BOTTEMP)
  ) %>% # mean by day
  dplyr::ungroup() %>%
  dplyr::group_by(YEAR, SEASON, Region) %>%
  dplyr::summarise(
    Mean_surface_temperature = mean(day_mean_surf) %>%
      round(digits = 2),
    Mean_bottom_temperature = mean(day_mean_bot) %>%
      round(digits = 2)
  ) %>%
  character_to_factor() # mean by season-year

make_html_table(data, col_names = c(
  "Year", "Season", "Region",
  "Mean surface temperature", "Mean bottom temperature"
))
```
